# 流程机制建设及落地

流程机制，顾名思义，是将一系列的行为加以规范化的过程。所谓无规矩不成方圆，事实上，几乎所有行业都不约而同地制订了各自的流程机制，达到国家政策的提出和执行，小到餐厅的排队叫号，各种各样的流程机制充斥着我们的生活。软件开发同样不会例外，从软件工程诞生起，其开发流程机制就在不断演进，如今已经有了一套较为成熟的范例，前端开发作为软件工程的一个细分领域同样也在不断演进，下面我们将从前端开发的角度探究其流程机制的建设和落地。

## 流程机制的建设

一般来讲，前端开发流程大致可以分为以下几个阶段：

- 需求讨论

- 产品研发

- 测试和交付

- 代码维护

下面我们将分别加以说明。

### 需求讨论

需求讨论是后续开发的基础，高效严谨的需求讨论可以有效减少后期需求修改所带来的额外开发成本。具体而言，项目需求的讨论是一个复杂的系统性工程，可能会涉及到跨团队，跨部门，乃至跨公司主体的沟通和交流。而对于前端团队而言，可能情况更为多样化，例如：

1. 完全不参与具体需求讨论，只接收既定的开发任务

2. 全程参与到需求讨论中

3. 部分参与到需求讨论中

第一种情况，前端团队的沟通对象可能主要是产品经理或是具有产品经理职能的相关人员。这种情况下虽然降低了前端团队的初始沟通成本，但是当需求和实现存在矛盾时，将带来事倍功半的效果。

第二种情况，前端团队虽然能保证需求和开发相匹配，带无疑意耗费了大量的时间在需求沟通上，而很多需求的讨论实际上与前段团队关系不大。

最后一种方式则是我这里所推崇的。我们可以将需求进行分类，大致可分为后端需求，前端需求，以及综合需求三个大类。后端需求和前端需求是指能够明确断定该需求仅和后端或前端相关，因此可以分开与用户或相关团队进行沟通，而对于难以界定的需求讨论，则可以让前后端人员一起参加，这样的好处是能够综合前两种沟通模式的有点，更加高效的完成需求讨论。

当然，该方法也会增加额外的需求划分所带来的成本，但总体而言不失为一个相对灵活可靠的需求讨论方案。

### 产品研发

完成第一阶段的需求讨论之后，将进入正式的产品研发阶段，这里我更愿意把本阶段细分为**架构设计**和**功能开发**。

#### 架构设计

这是产品研发的第一个阶段，在很多小型团队往往因为急于求成而忽略或草率完成本阶段，实际上这是非常不可取的研发思路，毕竟产品研发不是做一些个人的demo项目，需要结合具体业务来设计项目的整体架构。一个好的架构需要兼顾功能实现和后期维护两个大方向。要知道对于绝大多数项目而言，需求往往不会一蹴而就，更多时候是不断迭代上升的，如果不想后期面对需求变化或debug时抓耳挠腮，晕头转向，那么不如先停下来，好好想想代码的架构如何设计吧！

接下来我们总结一下于前端开发尤其`React`开发而言，一些较为常用的项目架构思路：

1. 配置文件分离

2. 工具函数分离

3. 共有组件分离

4. 静态资源文件分离

5. 相同类型文件聚合(类型的划分可以根据需求有不同的定义)

6. 状态及其修改逻辑与具体业务分离

7. 对于架构层面的api调用设置合理的钩子，保留一定的开发灵活度

8. 使用webpack或gulp等相关工具及技术栈实现自动化开发及校验

9. 使用git等工具进行版本管理和工作流建设

10. 建立脚手架等工具规范化项目初始构建

#### 功能开发

架构设计往往会根据已有的项目结构进行微调，因此对于较为成熟的团队而言，产品研发阶段的主体依旧会是具体功能的开发。作为一个技术管理者，产品功能的开发也必然是其工作的一大侧重点。下面我们将就功能开发的流程做简要的分析。

##### 开发任务的分发

这是功能开发的第一个流程，通常来讲会有两种形式：

1. 由技术管理者直接分发。

2. 有开发人员进行自主认领。

两种方式都有各自适用的场景，直接分发的方式适用于技术管理者对于需求和实现难度以及团队成员的工作能力有一个较为清晰的把握，在此基础上，方能做到高效可执行。而自主认领的方式则要求团队成员对于自身能力和功能需求认知较为清晰，并有足够的责任感。

不管使用哪种方式，技术管理者都需要将工作任务进行量化，做到心中有数，方能自如的把控项目的开发进度。

##### 开发任务的执行

开发人员拿到各自的开发任务后，将正式开始进行产品功能的开发，一般而言同样会有两种方式：

1. 直接根据需求进行开发

2. 先根据需求编写测试用例，然后进行功能开发(TDD)

直接开发的方式相信也是目前国内更为普遍的一种开发模式，优点是节省了编写测试用例的时间成本，缺点是增加了后期测试交付以及需求变动所带来的维护成本。而测试驱动开发的开发方式则恰恰相反。那么我们应该分别在什么场景下使用呢？

- 当项目本身维护周期较短，且功能较为简单，或纯粹只是一个demo时，应当采用直接开发的模式。

- 当项目是需要长期维护，且功能复杂都较高的企业级项目时，测试驱动开发(TDD)的方式无疑会大大降低项目的维护成本。

因此，我们需要根据项目本身的性质来判断，具体问题具体分析。

### 测试和交付

本阶段的最终目的是为了交付产品，测试是为了最终的交付服务的。需要注意的是，这里的测试和开发阶段的单元测试不是一回事，是一个更广义的测试概念，包括了功能测试，性能测试，安全测试，特性测试等等，一般由专业的测试团队来负责。

作为研发团队，这时需要对测试反馈出来的问题进行处理，这就重新涉及到一个分工的问题。众所周知，测试工程师在遇到bug时，通常会将问题抛给前端团队。因而潜移默化下，前端团队往往还会承担起bug管理的角色，这就需要前端团队做好和测试团队及后端团队的沟通。即不能推卸责任，也不能大包大揽，以解决问题为中心，就事论事。

### 代码维护

代码维护阶段是开发流程的另一个重要阶段，在软件工程学中，甚至认为其比重会占据整个开发流程的60%左右。在此前提到的几个阶段中，我们其实都有相关的原则或措施来保障和降低维护阶段的时间成本，但即便如此，维护阶段的管理仍然不可或缺。

除了代码质量本身以外，个人认为影响软件维护的高效执行还有有以下几个因素：

1. **需求的可迭代性**：我们需要和用户或相关团队一起就新需求进行分析和讨论，并尽量将其具体化和书面化，不能模棱两可，也不能朝令夕改。

2. **工作内容的量化**：常见的一种场景是，新需求不是一次性提供，而是具有周期性和阶段性的特点，这时负责维护的开发人员往往出现时忙时闲的状况，这实际上就是工作内容未能量化所导致的。我们需要通过工作内容的量化，来平衡开发人员的工作时间，从而实现较高的开发效率。

## 流程机制的落地

此前的内容主要是我对流程机制建立所坐的一些思考，那么我们如何来保障建立的流程机制能够得到切实的执行呢？我认为可以从主观和客观两个层面来着手。

### 主观层面

流程机制的面向主体是开发人员，要想保证流程机制的落实，开发人员的认同感是必不可少的。而提高开发人员对流程机制的认同感可以从以下几个方面来着手：

1. **组织培训**：组织开发人员进行相关培训，加深其对流程机制的了解，并阐明如此设计的一些内在原因。

2. **组织分享会**：就实践过程中，流程机制所带来的一些经验和感受进行分享，让其他开发者能够避免一些坑。

### 客观层面

任何制度的建立仅仅只靠主观的自觉性往往是不够的，我们还需要建立一些客观约束来保障其执行：

1. **建立奖惩机制**：对于无故违背流程机制的行为给予一定的惩罚。

2. **建立监督机制**：尤其是针对代码质量的相关流程，如编码规范，单元测试等，可通过同行评审和负责人评审两种方式保障

3. **充分利用自动化工具**：可以通过`eslint`完成代码的自动校验，通过`gitlab`自带的`CI/CD`功能实现代码的持续集成。

## 总结

流程机制的建立不是一朝一夕的事，它需要各方的协同和沟通，需要一定得技术积累，需要一定的资源倾斜，更需要开发人员自身的严格遵守。尽管在建立初期需要付出相当大的努力，但磨刀不误砍柴工，一旦真正建立起一套合理的开发流程机制，那么必将大幅提高团队的开发效率和质量。